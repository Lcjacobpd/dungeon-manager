<!DOCTYPE html>
<html>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="vars/players.js"></script>
    <script type="text/javascript" src="vars/monsterbook.js"></script>
    <script type="text/javascript" src="vars/encounters.js"></script>

    <script type="text/javascript" src="fight.js"></script>
    <script type="text/javascript" src="mobs.js"></script>

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="form.css">

    <script type="text/javascript" src="table.js"></script>
    <link rel="stylesheet" href="table.css">

    <script rel="text/javascript" src="toast.js"></script>
    <link rel="stylesheet" href="toast.css">

    <script type="text/javascript" src="tagbox.js"></script>
    <link rel="stylesheet" href="tagbox.css">
    

    <popup id="contact-popup" style="visibility: hidden;">
        <div>Contact Info:</div>
        <p style="padding: 1rem; margin: 0">
            Thank you for using Dungeon Manager!
            Please feel free to contact with questions
            and critiques.
            <br/><br/>
            Github: <a href="https://github.com/Lcjacobpd/dungeon-manager" style="color: #b9bbbe;">Lcjacobpd/dungeon-manager</a>
        </p>
    </popup>

    <popup id="option-popup" style="visibility: hidden;">
        <div>Project Details:</div>
        <p style="padding: 1rem; margin: 0">
            Part of this project relies on
            <a href="https://github.com/jbt/tagbox" style="color: #b9bbbe;">jbt's Tagbox</a>
            js implimentation with a modified stylesheet.
            <br/><br/>
            This particular style is not so subtly inspired by discord.
        </p>
    </popup>


    <backdrop>
        <ribbon>
            <a onclick="showTab(0)">Dungeon Manager</a>
            <div style="display:flex;">
                <img src="img/message.svg" onclick="showToast(1)">
                <img src="img/setting.svg" onclick="showToast(2)">
            </div>
        </ribbon>

        <mainbody>
            <functions>
                <!-- home page "tab" -->
                <func id="f0" style="display: none;"></func>

                <func id="f1" onclick="showTab(1)">
                    <img src="img/player.svg"/>
                    <label>Add Player</label>
                </func>
                <func id="f2" onclick="showTab(2)">
                    <img src="img/monster.svg"/>
                    <label>Add Monster</label>
                </func>
                <func id="f3" onclick="showTab(3)">
                    <img src="img/encounter.svg"/>
                    <label>Add Encounter</label>
                </func>

                <break></break>

                <func id="f4" onclick="showTab(4)">
                    <img src="img/players.svg"/>
                    <label>Players</label>
                </func>
                <func id="f5" onclick="showTab(5)">
                    <img src="img/monster_book.svg"/>
                    <label>Monster Book</label>
                </func>
                <func id="f6" onclick="showTab(6)">
                    <img src="img/encounters.svg"/>
                    <label>Encounters</label>
                </func>

                <break></break>

                <func id="f7" onclick="showTab(7)">
                    <img src="img/roll.svg"/>
                    <label>Roll Initiative</label>
                </func>
                <!-- child control tab -->
                <func id="f8" style="display: none;"></func>

                <func id="f9" onclick="showTab(9)">
                    <img src="img/attack.svg"/>
                    <label>Fight Encounter</label>
                </func>
                <!-- child control tab -->
                <func id="f10" style="display: none;"></func>

            </functions>

            <content>
                <toast id="formerror">
                    <img src="img/warn.svg">
                    <p>Incomplete form</p>
                </toast>

                <homepage id="tab0" style="display: block;">
                    <div style="height: 90vh; width: 65vw; display: flex; justify-content: center; align-items:center;">
                        <img src="img/logo.svg" style="height: 50rem;">
                    </div>
                </homepage>

                <!-- ------------------------------------------------------------ -->

                <addplayer id="tab1" style="display: none;">
                    <myTitle>
                        <img src="img/player.svg">
                        Enter Player Details
                    </myTitle>

                    <form id="playerform">
                        <input type="text" name="player_name" placeholder="Player Name">
                        <input type="text" name="character_name" placeholder="Character Name">
                        <col2>
                            <input type="text" name="class" placeholder="Class">
                            <input type="number" name="health" placeholder="Health">
                        </col2>
                    </form>

                    <savebutton onclick="savePlayer()">
                        Save
                    </savebutton>

                    <toast id="playersaved" onclick="showTab(4)">
                        <img src="img/players.svg">
                        <p>Player saved to list</p>
                    </toast>
                </addplayer>


                <addmonster id="tab2" style="display: none;">
                    <myTitle>
                        <img src="img/monster.svg">
                        Enter Monster Details
                    </myTitle>

                    <form id="monsterform">
                        <input type="text" name="name" placeholder="Name">
                        <select type="text" name="status" placeholder="Status" id="status">
                            <option value="normal">normal</option>
                            <option value="blinded">blinded</option>
                            <option value="charmed">charmed</option>
                            <option value="deafened">deafened</option>
                            <option value="frightened">frightened</option>
                            <option value="grappled">grappled</option>
                            <option value="incapacitated">incapacitated</option>
                            <option value="invisible">invisible</option>
                            <option value="paralized">paralized</option>
                            <option value="petrified">petrified</option>
                            <option value="poisoned">poisoned</option>
                            <option value="prone">prone</option>
                            <option value="restrained">restrained</option>
                            <option value="stunned">stunned</option>
                            <option value="unconscious">unconscious</option>
                            <option value="exhausted">exhausted</option>
                            <option value="dead">dead</option>
                        </select>
                        <col2>                            
                            <input type="number" name="armor" placeholder="Armor Class">
                            <input type="number" name="health" placeholder="Health">
                        </col2>

                        <br/>

                        <col3>
                            <input type="number" name="str" placeholder="Str">
                            <input type="number" name="dex" placeholder="Dex">
                            <input type="number" name="con" placeholder="Con">
                        </col3>
                        <col3>
                            <input type="number" name="int" placeholder="Int">
                            <input type="number" name="wiz" placeholder="Wiz">
                            <input type="number" name="cha" placeholder="Cha">
                        </col3>

                        <br/>

                        <input type="text" name="dice" placeholder="Hit Dice">
                        <input type="text" name="res" placeholder="Resistance">
                    </form>

                    <savebutton onclick="saveMonster()">
                        Save
                    </savebutton>

                    <toast id="monstersaved" onclick="showTab(5)">
                        <img src="img/monster_book.svg">
                        <p>Monster saved to book</p>
                    </toast>
                </addmonster>


                <addencounter id="tab3" style="display: none;">
                    <myTitle>
                        <img src="img/encounter.svg">
                        Enter Encounter Details
                    </myTitle>

                    <form id="encounterform">
                        <input type="text" name="name" placeholder="Name">
                        <textarea id="encounter-notes" placeholder="Notes"></textarea>
                        <br/>
                        <div style="font-size: 16px; font-weight: bold; margin: 0.5rem;">Select Monsters</div>
                        <tagbox id="monster-tb"></tagbox>
                    </form>

                    <savebutton onclick="saveEncounter()">
                        Save
                    </savebutton>

                    <toast id="encountersaved" onclick="showTab(6)">
                        <img src="img/encounters.svg">
                        <p>Encounter saved to list</p>
                    </toast>
                </addencounter>

                <!-- ------------------------------------------------------------ -->

                <listplayers id="tab4" style="display: none;">
                    <myTitle>
                        <img src="img/players.svg">
                        Players List
                    </myTitle>

                    <r>
                        <myButton onclick="showTab(1)">
                            <img src="img/plus.svg">
                            <text>Add New</text>                     
                        </myButton>
    
                        <myButton onclick="savePBook()">
                            <img src="img/download.svg">
                            <text>Save All</text>
                        </myButton>
                    </r>

                    <br/>

                    <table id="playerlist" cellspacing="0" cellpadding="0">
                        <tr>
                            <th>Player</th>
                            <th>Character</th>
                            <th>Class</th>
                            <th>Health</th>
                            <th></th>
                        </tr>
                    </table>
                </listplayers>


                <monsterbook id="tab5" style="display: none;">
                    <myTitle>
                        <img src="img/monster_book.svg">
                        Monster Book
                    </myTitle>

                    <r>
                        <myButton onclick="showTab(2)">
                            <img src="img/plus.svg">
                            <text>Add New</text>                     
                        </myButton>
    
                        <myButton onclick="saveMBook()">
                            <img src="img/download.svg">
                            <text>Save All</text>
                        </myButton>
                    </r>

                    <br/>

                    <table id="monsterlist" cellspacing="0" cellpadding="0">
                        <tr>
                            <th>Name</th>
                            <th>Condition</th>
                            <th>Armor</th>
                            <th>Health</th>
                            <th></th>
                        </tr>
                    </table>
                </monsterbook>


                <encounterlist id="tab6" style="display: none;">
                    <myTitle>
                        <img src="img/encounters.svg">
                        Encounters List
                    </myTitle>

                    <r>
                        <myButton onclick="showTab(3)">
                            <img src="img/plus.svg">
                            <text>Add New</text>                     
                        </myButton>

                        <myButton onclick="saveEBook()">
                            <img src="img/download.svg">
                            <text>Save All</text>
                        </myButton>
                    </r>

                    <br/>

                    <table id="encounterlist" cellspacing="0" cellpadding="0">
                        <tr>
                            <th>Name</th>
                            <th>Notes</th>
                            <th></th>
                        </tr>
                    </table>
                </encounterlist>

                <!-- ------------------------------------------------------------ -->

                <runencounter id="tab7" style="display: none;">
                    <myTitle>
                        <img src="img/roll.svg">
                        Roll Initiative
                    </myTitle>           

                    <controls id="tab8" style="display: none;">
                        <div id="people">
                            <!-- hold all involved combatants -->
                        </div>

                        <myButton onclick="sortFighters()">
                            <img src="img/attack.svg">
                            <text>Fight</text>
                        </myButton>
                    </controls>
                </runencounter>

                
                <fightencounter id="tab9" style="display: none;">
                    <myTitle>
                        <img src="img/attack.svg">
                        Fight Encounter
                    </myTitle>

                    <controls id="tab10" style="display: none;">
                        <box style="width: 44.1rem; background-color:#202225; border-radius: 8px 8px 0 0; margin-top: 2.5rem; border: none">
                            <p>
                                Name
                                <p style="width: 1rem; margin-left: 5rem;">AC</p>
                                <p style="margin-left: 2rem; width:35rem">Modifiers</p>
                            </p>
                            <p>HP</p>
                            <p>Condition</p>
                            
                        </box>
                        <div id="fighters">
                            <!-- hold sorted fighters list -->
                        </div>

                        <r>
                            <myButton onclick="next()">
                                <img src="img/attack.svg">
                                <text>Next</text>
                            </myButton>

                            <healthbar id="hpBar"></healthbar>
                        </r>
                        
                    </controls>

                </fightencounter>
            </content>

        </mainbody>
    </backdrop>
    
</html>

<script>
    //First time page load function.
    window.onload = function() {
        // Populate Players table.
        for(var i = 0; i < Players.length; i++) {
            var player = Players[i];
            addPlayerRow(player);
        }

        // Populate Monsterbook table.
        for(var i = 0; i < MonsterBook.length; i++) {
            var monster = MonsterBook[i];
            addMonsterRow(monster);
        }

        // Populate Encounters table.
        for(var i = 0; i < Encounters.length; i++) {
            var encounter = Encounters[i];
            addEncounterRow(encounter);
        }
    }

    // Create array of first items in nested array
    function getFirstArray(array){
        var firstArray = []
        for (var i = 0; i < array.length; i++) 
            firstArray.push(array[i][0]);
        
        return firstArray;
    }

    function showTab(num, kid=-1) {
        // Toggle tab visibility.
        selected = "tab" + num;
        for (var x = 0; document.getElementById("tab"+x) != null; x++) {
            if ("tab"+x == selected) {
                document.getElementById("tab"+x).style.display = "block";
                document.getElementById("f"+x).style.backgroundColor = "#40444b";
            } else {
                document.getElementById("tab"+x).style.display = "none";
                document.getElementById("f"+x).style.backgroundColor = "";
            }
        }

        // If present, show child tab.
        if (kid > -1) {
            document.getElementById("tab"+kid).style.display = "block";
        }

        // refresh monster tagbox.
        $('#monster-tb').tagbox({
            allowDuplicates: true,
            maxItems: 18,
            items: getFirstArray(MonsterBook)
        });
    }
</script>